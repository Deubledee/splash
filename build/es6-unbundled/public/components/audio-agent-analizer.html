<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"></head><body><dom-module id="audio-agent-analizer"><template><style include="shared-styles-dropdown">:host{width:100%;}nav{display:inline-flex;background-color:var(--app-analizer-background-color);float:right;}article{display:flex;flex-flow:column;padding:7px;box-sizing:border-box;}section{display:inline-flex;margin-top:5px;}section[canvas]{flex-basis:100px;box-shadow:var(--app-analizer-shadow);}paper-item[sellected]{background-color:chartreuse;}paper-tabs{background-color:var(--app-analizer-background-color);color:var(--app-color);width:100%;}paper-tabs.diferernt{--paper-tabs-selection-bar:{border-bottom:2px solid var(--paper-tabs-selection-bar-color, #aaaaaa);};}paper-tabs.diferernt[sellect]{--paper-tabs-selection-bar:{border-bottom:2px solid chartreuse;};}@media (min-width: 1300px){nav{padding-left:9.7%;}}@media (min-width: 1400px){nav{padding-left:19.7%;}}@media (min-width: 1550px){nav{padding-left:28.7%;}}@media (min-width: 1700px){nav{padding-left:30.7%;}}@media (min-width: 1745px){nav{padding-left:41%;}}</style><nav><article><section canvas=""><canvas id="canvas" width="[[itemWidth]]" height="[[itemHeigt]]"></canvas></section><section><paper-tabs selected="0" scrollable="" sellect$="[[sellect]]" class="diferernt"><template is="dom-repeat" items="{{sources}}" as="source" mutable-data="true"><paper-tab on-click="connecTo">[[source.name]]</paper-tab></template></paper-tabs></section></article><article><section><paper-dropdown-menu class="custom custom3" label="[[value]]"><paper-listbox id="listBox1" slot="dropdown-content" class="dropdown-content" selected="0"><template is="dom-repeat" items="{{options}}" as="option" mutable-data="true"><paper-item on-click="analizer" id="[[option.id]]" value="[[option.name]]">[[option.name]]</paper-item></template></paper-listbox></paper-dropdown-menu></section></article></nav></template><script>class audioAgentAnalizer extends Polymer.Element{static get is(){return"audio-agent-analizer"}constructor(){super()}ready(){super.ready();let ctx=this.$.canvas.getContext("2d");this.context2d=ctx;this.context2d.fillStyle="#000000";this.context2d.fillRect(0,0,this.$.canvas.width,this.$.canvas.height);this.agentClass.analyser(err=>{if(err){throw this.error("analizer ",err)}},this.elemTitle);window.addEventListener("source",event=>{setTimeout(()=>{let arr=this.sources;this.sources=[];if(!arr[0].name){arr=[{name:event.detail.name,type:event.detail.type}]}else{arr.push({name:event.detail.name,type:event.detail.type})}this.sources=arr},100)},!1);window.addEventListener("remove-source",event=>{let arr=this.sources;this.sources=[];let arr2=[];this.sources=0<arr2.length?arr2:[""];if(this.connected.sourceName===event.detail.name){var source={name:event.detail.name,type:event.detail.type};const evt={model:{__data:{source:source}}};this.analizer(evt,!0);this.connecTo(evt,!0)}for(let i=0;i<arr.length;i++){if(event.detail.name!==arr[i].name){arr2.push(arr[i])}}this.sources=1>arr2.length?[""]:arr2})}static get properties(){return{elemTitle:{type:String,value:"analizer1"},itemWidth:{type:String},itemHeigt:{type:String},context2d:{type:Object},connected:{type:Object,value:function(){return{source:!1,sourceName:""}}},sellect:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0},agentClass:{type:Object,notify:!0},value:{type:String,value:"Graphs",notify:!0},sources:{type:Array,value:[""],notify:!0},source:{type:Boolean,value:!0},options:{value:[{id:"Graphs",name:"Analizer Graphs"},{id:"sineWave",name:"Sine Wave"},{id:"barGraph",name:"Bar Graph"},{id:"bubbleBurst",name:"Bubble Burst"}]},sellectedElements:{type:Object,value:{item:{}}}}}typer(event){if("source"===event||"stream"===event){this.source=!0}else{this.source=!1}}error(msg,err){console.error(msg,err)}analizer(event){let par=Object.keys(this.agentClass.analyserNode);if(this.sellectedElements.item.value===void 0&&event.model.children){event.model.children[1].setAttribute("sellected",!0);this.sellectedElements.item=event.model.children[1];this.agentClass[event.model.__data.option.id](err=>{if(err){throw this.error("analizer",err)}},this.context2d,this.$.canvas.width,this.$.canvas.height,par[0])}else if(this.sellectedElements.item.value!==void 0){this.sellectedElements.item.removeAttribute("sellected",!0);this.sellectedElements.item={};this.agentClass.killVisual(this.context2d,this.$.canvas.width,this.$.canvas.height)}}connecTo(event,kill){let dest=this.agentClass.sourceNode[event.model.__data.source.name];if(!1===this.connected.source&&!0!==kill){this.connectMe(event.model.__data.source.name,dest)}else if(!0===this.connected.source&&event.model.__data.source.name===this.connected.sourceName&&!0!==kill){this.disconnectMe(event.model.__data.source.name,dest)}else if(event.model.__data.source.name!==this.connected.sourceName&&!0!==kill){this.disconnectOther(event.model.__data.source.name)}if(!0===kill){this.disconnectMe(event.model.__data.source.name,dest,kill)}}connectMe(name,dest){this.agentClass.connectAgents(err=>{if(err){throw this.error("connector ",err)}this.connected.source=!0;this.sellect=!0;this.connected.sourceName=name},dest,this.agentClass.analyserNode[this.elemTitle],!0)}disconnectMe(name,dest){this.agentClass.connectAgents(err=>{if(err){throw this.error("connector ",err)}this.connected.source=!1;this.sellect=!1;this.connected.sourceName=""},dest,this.agentClass.analyserNode[this.elemTitle],!1)}disconnectOther(){let dest=this.agentClass.sourceNode[this.connected.sourceName]||this.agentClass.contextNode[this.connected.sourceName];this.agentClass.connectAgents(err=>{if(err){throw this.error("connector ",err)}this.connected.source=!1;this.sellect=!1;this.connected.sourceName=""},dest,this.agentClass.analyserNode[this.elemTitle],!1)}changeToOne(data){this.value=data.model.__data.option.id;setTimeout(()=>{this.value="Graphs"},100)}}window.customElements.define(audioAgentAnalizer.is,audioAgentAnalizer);</script></dom-module></body></html>